\documentclass{report}

\usepackage{a4wide}
\usepackage{algpseudocode}
\usepackage{algorithm}
\usepackage{datetime2}

\title{Algorithms to be used in the Talos implementations}

\begin{document}
	\maketitle

	\tableofcontents

	\chapter{Constructing the individual access trees}
	\begin{algorithm}
		\begin{algorithmic}[1]
			\Function{changeImplicitAccess}{node $ node $, boolean $ access $}
				\State Set property $ access $ of $ node $ to $ access $
				\ForAll{children $ child $ of $ node $}
					\If{property $ explicit $ of $ child $ is false}
						\State \Call{changeImplicitAccess}{$ child $, $ access $}
					\EndIf
				\EndFor
			\EndFunction

			\Function{addPath}{node $ node $, string $ path $, boolean $ access $}
				\If{$ path $ is empty}
					\State Set property $ explicit $ of $ node $ to true
					\State \Call{changeImplicitAccess}{$ node $, $ access $}
					\State \Return
				\EndIf
				\State Get first part $ start $ of $ path $
				\If{$ node $ has no child called $ start $}
					\State Add child $ child $ with name $ start $ to $ node $
					\State Set property $ access $ of $ child $ to $ access $ of $ node $
				\EndIf
				\State Remove $ start $ from $ path $
				\State Get child node $ child $ with name $ start $ of $ node $
				\State \Call{addPath}{$ child $, $ path $}
			\EndFunction

			\State Given role $ role $ and default access $ access $ 
			\State Create root node $ tree $
			\ForAll{permission rules $ rule $ for $ role $}
				\State Get properties $ path $ and $ access $ of $ rule $
				\State \Call{addPath}{$ tree $, $ path $, $access $}
			\EndFor
			\State \Return $ tree $
		\end{algorithmic}
	\end{algorithm}

	\chapter{Constructing the inherited access tree for a role}
	\begin{algorithm}
		\begin{algorithmic}[1]
			\Function{mergeTrees}{$ tree $, $ inheritTree $}
				\If{property $ explicit $ of $ tree $ is true}
					\State \Return $ tree $
				\EndIf
				\If{property $ explicit $ of $ inheritTree $ is true}
					\State \Call{changeImplicitAccess}{$ tree $, property $ access $ of $ inheritTree $}
					\State Set property $ explicit $ of $ tree $ to true
				\EndIf
				\ForAll{children $ inheritChild $ with name $ name $ of $ inheritTree $}
					\If{$ tree $ has no child called $ name $}
						\State Add $ inheritChild $ to $ tree $ with name $ name $
					\Else
						\State Get child node $ child $ with name $ name $ from $ tree $
						\State \Call{mergeTrees}{$ child $, $ inheritChild $}
					\EndIf
				\EndFor
				\State \Return $ tree $
			\EndFunction
			\Function{constructTree}{role $ role $}
				\State Construct the individual access tree $ tree $ for $ role $
				\If{$ role $ has no parent}
					\State \Return $ tree $
				\EndIf
				\State Get parent role $ parent $ of $ role $
				\State Get root node $ inheritTree $ of \Call{constructTree}{$ parent $}
				\State \Return \Call{mergeTrees}{$ tree $, $ inheritTree $}
			\EndFunction
			\State Given $ role $ role
			\State \Return \Call{constructTree}{$ role $}
		\end{algorithmic}
	\end{algorithm}

\end{document}
